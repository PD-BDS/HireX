analyse_user_query:
  description: |
    ## Mission
    Dissect the recruiter’s latest question, inspect the available screening outputs and job snapshot, and produce
    a structured briefing that the responder can trust.

    ## Inputs
    - Latest recruiter turn:
      {user_query}
    - Candidate screening snapshot (analysis output):
      {screened_candidates}
    - Job description snapshot:
      {job_snapshot}

    ## Required Actions
    1. Capture the recruiter’s intent, urgency, and tone within `findings`, weaving in the key facts pulled from `screened_candidates`, the job snapshot, and any relevant session knowledge records.
    2. Audit the candidates you plan to reference; when the supporting fact is not already backed by `knowledge_references`, call **Fetch Candidate Evidence** to pull a resume excerpt before drafting conclusions.
    3. When additional detail is needed beyond the snapshot, call **Fetch Candidate Profiles** (structured resume data) or **Search Resumes** (adjacent resume snippets) to close gaps.
    4. Use `reasoning` to outline supporting evidence, risks, or policy considerations the responder must mention—cite candidates or tool findings in plain language so non-technical readers can follow.
    5. Populate `recommended_actions` with concrete steps the responder should encourage, and list any clarifications the recruiter should be asked for in `follow_up_questions`.
  expected_output: |
    Give your response only in this JSON validating `DiscussionAnalysisOutput`, do not include any other text or tool calls:
      {
        "findings": "<succinct paraphrase of the recruiter request and relevant candidate facts>",
        "reasoning": "<bullet or paragraph detailing supporting evidence and trade-offs>",
        "recommended_actions": ["<action the responder should propose>", ...],
        "follow_up_questions": ["<clarification to ask the recruiter>", ...]
      }
    - Every list may be empty, but include the key with an empty array when no items apply.
    - Reference candidate names or IDs exactly as they appear in `screened_candidates`.
    - This JSON is your final answer - do not include any other text or tool calls.
  agent: discussion_analyser


compose_structured_response:
  description: |
    ## Mission
    Turn the analyser’s briefing into the recruiter-facing reply, keeping the tone supportive while anchoring each
    statement in the verified evidence.

    ## Inputs
    - Latest recruiter turn:
      {user_query}
    - Candidate screening snapshot (analysis output):
      {screened_candidates}
    - Job description snapshot:
      {job_snapshot}

    ## Required Actions
    1. Build on the analyser’s findings (available via task memory) so `acknowledgement` links naturally to the recruiter’s question.
    2. If any claim you plan to repeat lacks a supporting excerpt in task memory, call **Fetch Candidate Evidence** to capture the citation before composing the reply.
    3. Double-check the knowledge store and, when needed, call **Fetch Candidate Profiles** or **Search Resumes** to refresh facts before responding.
    4. Populate `query_answers` with clear, recruiter-ready language that cites the relevant candidates, fit scores, or job requirements without referring to technical scoring terms (explain impact instead of math).
    5. Use `reasoning` to justify the recommendations, list concrete action items in `follow_ups`, and close with an encouraging sign-off aligned with the recruiter’s tone.

  expected_output: |
    Produce only this JSON validating `DiscussionOutput`, do not include any other text or tool calls:
      {
        "message_md": {
          "acknowledgement": "<natural opener>",
          "query_answers": "<direct response>",
          "reasoning": "<why the guidance is sound>",
          "follow_ups": "<clear next steps>",
          "closing": "<friendly wrap-up>"
        },
        "phase": "discussion"
      }
    - Ensure the final response is ready to send as-is; it should not require further editing.
    - Keep the message empathetic, fact-based, and aligned with the recruiter’s objectives.
    - This JSON is your final answer - do not include any other text or tool calls.
  agent: structured_responder